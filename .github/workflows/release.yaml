name: CICD
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup Go
        uses: actions/setup-go@v2
        with:
          go-version: "1.17.6"
      - name: Install dependencies
        run: |
          go version
          go get -u github.com/alphahorizonio/libentangle@latest
          go get -u github.com/fclairamb/go-log@latest
          go get -u github.com/jacobsa/fuse@latest
          go get -u github.com/spf13/cobra@latest
          go get -u github.com/spf13/viper@latest
          go get -u github.com/volatiletech/sqlboiler@latest
      - name: Build 
        run: go build .
      - name: Publish pre-release to GitHub releases
        if: ${{ github.ref == 'refs/heads/main' }}
        uses: marvinpinto/action-automatic-releases@latest
        with: 
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          automatic_release_tag: unstable
          prerelease: true
          files: entangle
